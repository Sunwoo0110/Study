# ğŸ“š Spring Bean & Container

---

## 1. ì£¼ì œ/í‚¤ì›Œë“œ
- Spring containerì™€ bean ê°œë…, ìƒëª…ì£¼ê¸°, @Transactionalê³¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ê´€ê³„ì— ëŒ€í•´ ì•Œì•„ë³´ì~ (ã£- â€¸ â€“ Ï‚)

---

## 2. í•µì‹¬ ìš”ì•½ (Summary)

### Spring Container (ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ)
- ìŠ¤í”„ë§ì—ì„œ **ê°ì²´(Bean)ë¥¼ ê´€ë¦¬í•˜ëŠ” ë°•ìŠ¤** ê°™ì€ ì¡´ì¬
- ì—­í• 
  - ê°ì²´ ìƒì„± (new ëŒ€ì‹  í•´ì¤Œ)
  - ì˜ì¡´ì„± ì£¼ì…
  - ìƒëª…ì£¼ê¸° ê´€ë¦¬ (ì´ˆê¸°í™”, ì¢…ë£Œ ì‹œì ê¹Œì§€ ê´€ë¦¬)
- ì™œ ì“°ëƒ?
  - ê°œë°œìê°€ `new`ë¡œ ë§Œë“¤ê³  ì—°ê²°í•˜ëŠ” ê³¼ì •ì´ ì—†ì–´ì§
  - ê°ì²´ ê°„ ê²°í•©ë„ë¥¼ ë‚®ì¶”ê³ , í…ŒìŠ¤íŠ¸, í™•ì¥ì„±ì„ ë†’ì„
- ì—¬ê¸°ì„œ ì ê¹!
- ì˜ì¡´ì„± ì£¼ì…ì´ë€?
  - ì–´ë–¤ ê°ì²´ê°€ í•„ìš”ë¡œ í•˜ëŠ” **ë‹¤ë¥¸ ê°ì²´**(ì˜ì¡´ì„±)ë¥¼ ê°œë°œìê°€ ì§ì ‘ new í•´ì„œ ë§Œë“œëŠ” ëŒ€ì‹ , **ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ëŒ€ì‹  ë§Œë“¤ì–´ì„œ ë„£ì–´ì£¼ëŠ” ê²ƒ**
  - ê°ì²´ ê°„ ê²°í•©ë„ë¥¼ ë‚®ì¶”ê³ , ì½”ë“œ ì¬ì‚¬ìš©ì„±ê³¼ í…ŒìŠ¤íŠ¸ ìš©ì´ì„±ì„ ë†’ì„

---

### Spring Bean (ìŠ¤í”„ë§ ë¹ˆ)
- ì»¨í…Œì´ë„ˆê°€ ê´€ë¦¬í•˜ëŠ” **ê°ì²´ ì¸ìŠ¤í„´ìŠ¤**
- ê°œë°œìê°€ ì§ì ‘ ë§Œë“  í´ë˜ìŠ¤(@Service, @Repository ë“±)ë‚˜, ì„¤ì •(@Bean)ìœ¼ë¡œ ë“±ë¡í•œ ì• ë“¤ì´ ë¹ˆì´ ë¨
- **ìŠ¤í”„ë§ì´ ëŒ€ì‹  ê´€ë¦¬í•˜ëŠ” ê°ì²´**
- ê°œë°œìê°€ ì§ì ‘ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì—°ê²°í•˜ë©´ ê²°í•©ë„ ë†’ê³  í…ŒìŠ¤íŠ¸ ì–´ë ¤ì›€
- ë”°ë¼ì„œ ìŠ¤í”„ë§ì´ ëŒ€ì‹  ê´€ë¦¬í•˜ë©´
  - í•„ìš”í•œ ì‹œì ì—ë§Œ ìƒì„±í•´ì„œ ë©”ëª¨ë¦¬ ì ˆì•½ (ì‹±ê¸€í„´)
  - ë‹¤ë¥¸ êµ¬í˜„ì²´ë¡œ ì‰½ê²Œ êµì²´ ê°€ëŠ¥
  - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‰¬ì›€

---

### Bean ë“±ë¡ ë°©ë²•
- **ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”** (`@ComponentScan`)
  - `@Component`, `@Service`, `@Repository`, `@Controller` ë¶™ì€ í´ë˜ìŠ¤ë¥¼ ìë™ íƒì§€
  - ê°€ì¥ í”í•œ ë°©ì‹, ë³´í†µ ìŠ¤í”„ë§ ë¶€íŠ¸ ë©”ì¸ í´ë˜ìŠ¤ ê¸°ì¤€ í•˜ìœ„ íŒ¨í‚¤ì§€ë¥¼ ì‹¹ ìŠ¤ìº”
- **ìë°” ì„¤ì • ë©”ì„œë“œ** (`@Bean`)
  - ë©”ì„œë“œ ì•ˆì—ì„œ ê°ì²´ë¥¼ ì§ì ‘ ìƒì„±í•´ì„œ ì»¨í…Œì´ë„ˆì— ë“±ë¡
  - ì£¼ë¡œ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°ì²´ë‚˜ ìƒì„± ê³¼ì •ì´ ë³µì¡í•œ ì• ë“¤
- **ì„¤ì • í´ë˜ìŠ¤** (`@Configuration`)
  - `@Bean` ì—¬ëŸ¬ ê°œ ë¬¶ì–´ì„œ ê´€ë¦¬í•˜ëŠ” ì„¤ì • íŒŒì¼
  - ë‚´ë¶€ì ìœ¼ë¡œ CGLIB í”„ë¡ì‹œê°€ ê°œì…í•´ì„œ ê°™ì€ Beanì„ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•´ë„ ì‹±ê¸€í„´ ë³´ì¥

---

### Bean LifeCycle (ë¹ˆ ìƒëª…ì£¼ê¸°)

```
ì»¨í…Œì´ë„ˆ ì‹œì‘
-> Bean ìƒì„± (ê°ì²´ new)
-> ì˜ì¡´ì„± ì£¼ì… (DI)
-> ì´ˆê¸°í™” ì½œë°± (@PostConstruct ê°™ì€ ì´ˆê¸°í™” ë©”ì„œë“œ ì‹¤í–‰)
-> ì• í”Œë¦¬ì¼€ì´ì…˜ ë™ì‘
-> ì¢…ë£Œ ì§ì „ ì†Œë©¸ ì½œë°± (@PreDestroy ê°™ì€ cleanup ì‹¤í–‰)
ì»¨í…Œì´ë„ˆ ì¢…ë£Œ
```
- ìì£¼ ì“°ëŠ” ì½œë°±
  - `@PostConstruct`: ì´ˆê¸° ì„¸íŒ… (ex. ìºì‹œ ë¡œë”©)
  - `@PreDestroy`: ì¢…ë£Œ ì „ ì •ë¦¬ (ex. ì»¤ë„¥ì…˜ ë‹«ê¸°)

---

### @Transactionalê³¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸
- ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê±´ **Bean ìƒëª…ì£¼ê¸°ì™€ íŠ¸ëœì­ì…˜/ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìƒëª…ì£¼ê¸°**ê°€ ë‹¤ë¥´ë‹¤ëŠ” ê±°!
- `@Service` ê°™ì€ Bean: ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘í•  ë•Œ ë”± 1ë²ˆ ë§Œë“¤ì–´ì§ (ì‹±ê¸€í„´)
- `@Transactional`
  - ë©”ì„œë“œ í˜¸ì¶œ ìˆœê°„ í”„ë¡ì‹œê°€ íŠ¸ëœì­ì…˜ ì—´ê³  ë‹«ìŒ
  - íŠ¸ëœì­ì…˜ ë²”ìœ„ ì•ˆì—ì„œ **ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸**(EntityManager)ê°€ ì‘ë™ -> DB ì—”í‹°í‹° ê´€ë¦¬
  - ì»¤ë°‹ ì‹œì ì— flush -> DB ë°˜ì˜
- ë”°ë¼ì„œ **Bean ìì²´ëŠ” ê³„ì† ì‚´ì•„ìˆìŒ**, **íŠ¸ëœì­ì…˜/ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ë©”ì„œë“œ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ ì—´ë ¸ë‹¤ ë‹«í˜**
- ì£¼ì˜ ì‚¬í•­: ê°™ì€ í´ë˜ìŠ¤ ì•ˆì—ì„œ `@Transactional` ë©”ì„œë“œë¼ë¦¬ ì„œë¡œ í˜¸ì¶œí•˜ë©´ í”„ë¡ì‹œë¥¼ ì•ˆ ê±°ì³ì„œ íŠ¸ëœì­ì…˜ì´ ì•ˆ ê±¸ë¦´ ìˆ˜ ìˆìŒ (self-invocation ë¬¸ì œ)
- ì—¬ê¸°ì„œ ì ê¹!
- Self-invocation ë¬¸ì œë€?
  - `@Transactional`ì€ **í”„ë¡ì‹œ**(proxy)ë¥¼ í†µí•´ ë™ì‘í•¨
  - ì¦‰, ìŠ¤í”„ë§ì´ ì‹¤ì œ ê°ì²´ ì•ì— í”„ë¡ì‹œ ê°ì²´ë¥¼ í•˜ë‚˜ ë” ì”Œì›Œì„œ íŠ¸ëœì­ì…˜ ì‹œì‘/ì»¤ë°‹ì„ ì²˜ë¦¬í•¨
  - ê·¸ëŸ°ë° ê°™ì€ í´ë˜ìŠ¤ ì•ˆì—ì„œ ìê¸° ìì‹ ì˜ ë‹¤ë¥¸ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ í”„ë¡ì‹œë¥¼ ê±°ì¹˜ì§€ ì•ŠìŒ!!
    - ê·¸ëƒ¥ this.ë©”ì„œë“œ()ë¡œ ì§ì ‘ ì‹¤í–‰ë˜ë‹ˆê¹Œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠìŒ
  - ```java
        @Service
        public class testService {

            @Transactional
            public void test1() {
                // íŠ¸ëœì­ì…˜ ì‹œì‘ë¨
                test2(); // ê°™ì€ í´ë˜ìŠ¤ ë©”ì„œë“œ í˜¸ì¶œ!!
            }

            @Transactional
            public void test2() {
                // ì—¬ê¸°ì„œëŠ” íŠ¸ëœì­ì…˜ ì•ˆ ê±¸ë¦¼! (í”„ë¡ì‹œë¥¼ ì•ˆ ê±°ì³ì„œ)
            }
        }
        ```
  - **í´ë˜ìŠ¤ë¥¼ ë¶„ë¦¬**í•˜ê±°ë‚˜, **ìê¸° ìì‹ ì„ ì£¼ì…**í•´ì„œ í•´ê²°
    - ```java
        @Autowired
        private testService self; // í”„ë¡ì‹œê°€ ì£¼ì…ë¨

        @Transactional
        public void test1() {
            self.test2(); // í”„ë¡ì‹œë¥¼ ê±°ì¹˜ë¯€ë¡œ íŠ¸ëœì­ì…˜ ì ìš©ë¨
        }
        ```

---

## 3. ì°¸ê³ /ì¶”ê°€ ìë£Œ
- [Spring Docs - Bean LifeCycle](https://docs.spring.io/spring-framework/reference/core/beans/factory-nature.html)
- [Spring Docs - Component Scanning](https://docs.spring.io/spring-framework/reference/core/beans/classpath-scanning.html)
- [Spring Docs - @Bean & @Configuration](https://docs.spring.io/spring-framework/reference/core/beans/java/basic-concepts.html)
- [Spring Docs - @Transactional](https://docs.spring.io/spring-framework/reference/data-access/transaction/declarative/annotations.html)

---

## 4. ë‹¤ìŒì— ë³¼ ê²ƒ
- ì†”ì§íˆ ë°˜ë„ ì´í•´ ëª»í•œ ê²ƒ ê°™ì€ë°..ã…œã…  ìŠ¤í”„ë§ ì™œì´ë¦¬ ì–´ë µë‹ˆ
- ìŠ¤í”„ë§ ê°œë°œ ë” í•´ë³´ë©´ì„œ ì—¬ëŸ¬ë²ˆ ê³µë¶€í•˜ì~,,

