# ğŸ“š Transaction

---

## 1. ì£¼ì œ/í‚¤ì›Œë“œ
- ë°ì´í„°ë² ì´ìŠ¤(MySQL)ì˜ lock, transaction, isolation levelì— ëŒ€í•´ ì•Œì•„ë³´ì! âœŒï¸('Ï‰')âœŒï¸

---

## 2. í•µì‹¬ ìš”ì•½ (Summary)
### Transaction (íŠ¸ëœì­ì…˜)
- ì‘ì—… setì„ ëª¨ë‘ ì™„ë²½í•˜ê²Œ ì²˜ë¦¬í•˜ê±°ë‚˜, ì²˜ë¦¬ ë¶ˆê°€ëŠ¥ì¸ ê²½ìš°ì— ì› ìƒíƒœë¡œ ë³µêµ¬í•˜ëŠ” ê¸°ëŠ¥
- **ì‘ì—…ì˜ ì™„ì „ì„±ì„ ë³´ì¥**(partial update ë°©ì§€)
  - ë¶€ë¶„ ì—…ë°ì´íŠ¸ í˜„ìƒì´ ë°œìƒí•˜ë©´, ë‚¨ì€ ë ˆì½”ë“œë¥¼ ì‚­ì œí•˜ëŠ” ì¬ì²˜ë¦¬ ì‘ì—…ì´ í•„ìš”í•  ìˆ˜ ìˆìŒ -> ë‹¤ì¤‘ ì¿¼ë¦¬ì˜ ê²½ìš° ë§¤ìš° ë³µì¡!
- **ìµœì†Œí•œì˜ ì½”ë“œì—ë§Œ ì ìš©í•´ì•¼ í•¨!!**
- ì‚¬ìš©ìê°€ ê²Œì‹œíŒì— ê²Œì‹œê¸€ ì‘ì„± í›„ ì €ì¥ ë²„íŠ¼ ëˆŒë €ì„ ë•Œë¥¼ ê°€ì •í•´ë³´ì
  >> 1. ì²˜ë¦¬ ì‹œì‘(DB connection ìƒì„± + íŠ¸ëœì­ì…˜ ì‹œì‘)
  >> 2. ë¡œê·¸ì¸ í™•ì¸
  >> 3. ê¸€ì“°ê¸° ì˜¤ë¥˜ ì—¬ë¶€ í™•ì¸
  >> 4. ì²¨ë¶€ íŒŒì¼ í™•ì¸
  >> 5. ì‚¬ìš©ì ì…ë ¥ ë‚´ìš© DBMS ì €ì¥
  >> 6. ì²¨ë¶€ íŒŒì¼ DBMS ì €ì¥ 
  >> 7. ì €ì¥ ë‚´ìš© ì¡°íšŒ
  >> 8. ê²Œì‹œë¬¼ ë“±ë¡ ì•Œë¦¼ ë©”ì¼ ë°œì†¡
  >> 9. ì•Œë¦¼ ë°œì†¡ ì´ë ¥ DBMS ì €ì¥ (íŠ¸ëœì­ì…˜ ì¢…ë£Œ Commit + DB connection ë°˜ë‚©)
  >> 10. ì²˜ë¦¬ ì™„ë£Œ
  - ì‹¤ì œ ë°ì´í„° ì €ì¥ì€ 5ë²ˆì—ì„œ ì‹œì‘ -> 2,3,4ì˜ ê³¼ì •ì€ íŠ¸ëœì­ì…˜ì—ì„œ ì œê±°!
  - 8ë²ˆê³¼ ê°™ì€ ë©”ì¼ ì „ì†¡, íŒŒì¼ ì „ì†¡ ë“± **ë„¤íŠ¸ì›Œí¬ ì‘ì—…ì€ ìœ„í—˜** -> íŠ¸ëœì­ì…˜ì—ì„œ ì œê±°!
    - í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì¤‘ ë©”ì¼ ì„œë²„ì™€ í†µì‹ í•  ìˆ˜ ì—†ëŠ” ìƒí™©ì´ ë°œìƒí•˜ë©´ ì „ì²´ê°€ ìœ„í—˜í•´ì§(ì„œë²„ ë¶€í•˜ ê°€ëŠ¥ì„±)
  - ì‚¬ìš©ì ì…ë ¥ì„ ì €ì¥í•˜ëŠ” 5,6ë²ˆì€ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì–´ì•¼í•¨
  - 7ë²ˆì€ ë‹¨ìˆœ ë‚´ìš© ì¡°íšŒì´ë¯€ë¡œ íŠ¸ëœì­ì…˜ì—ì„œ ì œì™¸
  - 9ë²ˆì€ 5,6ë²ˆê³¼ ë‹¤ë¥¸ ë‚´ìš©ì´ë¯€ë¡œ ë³„ë„ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¶„ë¦¬
  - **DB connectionì„ ê°€ì§€ê³  ìˆëŠ” ë²”ìœ„ì™€ íŠ¸ëœì­ì…˜ì´ í™œì„±í™”ë¼ ìˆëŠ” í”„ë¡œê·¸ë¨ ë²ˆìœ„ë¥¼ ìµœì†Œí™”!!**
    - DB connection ìˆ˜ëŠ” ë³´í†µ ì œí•œì ì´ê¸° ë•Œë¬¸ì—, ì†Œìœ  ì‹œê°„ì´ ê¸¸ì–´ì§€ë©´ ì‚¬ìš© ê°€ëŠ¥í•œ ì—¬ìœ  ì»¤ë„¥ì…˜ ìˆ˜ê°€ ì¤„ì–´ë“¦ -> ì»¤ë„¥ì…˜ì„ ê°€ì§€ê¸° ìœ„í•´ ëŒ€ê¸°í•˜ëŠ” ìƒí™© ë°œìƒ

---

### MySQLì˜ Lock
### Global Lock
- í•œ ì„¸ì…˜ì—ì„œ ê¸€ë¡œë²Œ ë½ì„ íšë“í•˜ë©´ ë‹¤ë¥¸ ì„¸ì…˜ì—ì„œ `SELECT`ë¥¼ ì œì™¸í•œ ëŒ€ë¶€ë¶„ì˜ DDL, DMLì€ ëŒ€ê¸° ìƒíƒœ
- MySQL ì„œë²„ ì „ì²´ì— ì˜í–¥ ë¯¸ì¹¨
- `FLUSH TABLES WITH READ LOCK` ëª…ë ¹ìœ¼ë¡œ íšë“
- InnoDB ìŠ¤í† ë¦¬ì§€ ì—”ì§„ì€ íŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ê¸° ë•Œë¬¸ì—, ì¼ê´€ëœ ì‹œì ì˜ ë°ì´í„° ë°±ì—…ì—ëŠ” ê¸€ë¡œë²Œ ë½ë³´ë‹¤ **íŠ¸ëœì­ì…˜ ê¸°ë°˜ Consistent Snapshot ë°©ì‹**ì´ ë” ì¼ë°˜ì 
- ê¸€ë¡œë²Œ ë½ì€ ì£¼ë¡œ MyISAM ê°™ì€ íŠ¸ëœì­ì…˜ ë¯¸ì§€ì› ìŠ¤í† ë¦¬ì§€ ì—”ì§„ì—ì„œ ë°±ì—…ì„ ìœ„í•´ ì‚¬ìš©
- ê¸€ë¡œë²Œ ë½ì´ ê±¸ë¦° ìƒíƒœì—ì„œëŠ” DDLê¹Œì§€ í¬í•¨í•´ ëŒ€ë¶€ë¶„ì˜ ì“°ê¸° ì‘ì—…ì´ ì „ë¶€ ì •ì§€í•˜ë¯€ë¡œ, **ìš´ì˜ DBì—ì„œëŠ” ìœ„í—˜ë„ê°€ í¼**
- ëŒ€ì•ˆ: **ë°±ì—…ë½**
  - í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ, ì‚¬ìš©ì ì¸ì¦ ê´€ë ¨ ì •ë³´ ë³€ê²½ì€ í—ˆìš©í•˜ì§€ ì•ŠìŒ
  - ì¼ë°˜ì ì¸ í…Œì´ë¸”ì˜ ë°ì´í„° ë³€ê²½ì€ í—ˆìš©
  - ì£¼ë¡œ **Replica ì„œë²„**ì—ì„œ ì‚¬ìš©(ë°ì´í„° ë°±ì—…)
  - Replicaì—ì„œ ê¸€ë¡œë²Œ ë½ì„ íšë“í•˜ë©´, ë°±ì—… ì‹œê°„ë§Œí¼ ë³µì œê°€ ì§€ì—°ë¨
  - ë°±ì—…ë½ì€ ê¸€ë¡œë²Œ ë½ê³¼ ë‹¬ë¦¬ **DML(INSERT/UPDATE/DELETE)ì€ í—ˆìš©í•˜ë¯€ë¡œ ë³µì œê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰**ë¨
  - í•˜ì§€ë§Œ ìŠ¤í‚¤ë§ˆ ë³€ê²½(DDL)ì€ ë§‰í˜€ ìˆê¸° ë•Œë¬¸ì—, **ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜ë¡œ ì¸í•œ ë°±ì—… ì‹¤íŒ¨ ë°©ì§€ ê°€ëŠ¥**
  - MySQL 8.0 ì´ìƒì—ì„œ ì§€ì› (LOCK INSTANCE FOR BACKUP)
  - ëŒ€ê·œëª¨ ì„œë¹„ìŠ¤ì—ì„œëŠ” Percona XtraBackup ê°™ì€ Hot Backup íˆ´ì„ ë°±ì—…ë½ê³¼ í•¨ê»˜ ë§ì´ í™œìš©

---

### Table Lock
- ê°œë³„ í…Œì´ë¸” ë‹¨ìœ„ë¡œ ì„¤ì •ë˜ëŠ” lock
- ëª…ì‹œì  ë°©ë²•
  - `LOCK TABLES table_name [READ : WRITE]` ìœ¼ë¡œ íšë“
  - `UNLOCK TABLES` ìœ¼ë¡œ í•´ì œ
  - ì¼ë°˜ì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” **ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ** -> í…Œì´ë¸” ë‹¨ìœ„ ì „ì²´ê°€ ë§‰íˆë¯€ë¡œ ì˜¨ë¼ì¸ ì„œë¹„ìŠ¤ì— ì˜í–¥ì´ í¼
  - ì£¼ë¡œ MyISAM ê°™ì€ íŠ¸ëœì­ì…˜ ë¯¸ì§€ì› ìŠ¤í† ë¦¬ì§€ ì—”ì§„ì—ì„œ ë°ì´í„° ì¼ê´€ì„±ì„ ë§ì¶”ê±°ë‚˜, **ë‹¨ìˆœ/íŠ¹ìˆ˜ ì‘ì—…**(ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜, ë°°ì¹˜ ì‘ì—… ë“±)ì— ì‚¬ìš©ë¨
- ë¬µì‹œì  ë°©ë²•
  - ë°ì´í„° ë³€ê²½ ì¿¼ë¦¬ ì‹¤í–‰ ì‹œ í•´ë‹¹ í…Œì´ë¸”ì— ë½ ê±¸ê³ , ë³€ê²½ ì™„ë£Œ í›„ ì ê¸ˆ í•´ì œ
  - MyISAM í…Œì´ë¸”
    - INSERT, UPDATE, DELETE ì‹œ ìë™ìœ¼ë¡œ í…Œì´ë¸” ë‹¨ìœ„ ë½ ê±¸ë¦¼
    - ì½ê¸°/ì“°ê¸° ì‘ì—… ê°„ ì¶©ëŒ ë°œìƒ -> ë™ì‹œì„± ë‚®ìŒ
  - InnoDB í…Œì´ë¸”
    - **ë ˆì½”ë“œ ë½**(Row Lock) ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ë¯€ë¡œ ì¼ë°˜ì ì¸ ë°ì´í„° ë³€ê²½ ì¿¼ë¦¬ì—ì„œëŠ” í…Œì´ë¸” ë½ì´ ì•„ë‹Œ **í–‰ ë‹¨ìœ„ ë½ì´ ì‚¬ìš©**ë¨
    - í…Œì´ë¸” ë½ì€ **ìŠ¤í‚¤ë§ˆ ë³€ê²½**(DDL, ALTER TABLE ë“±)ì—ì„œë§Œ ì˜ë¯¸ê°€ ìˆìŒ
    - DDLì€ ë‚´ë¶€ì ìœ¼ë¡œ **MDL**(Metadata Lock)ì´ ê±¸ë ¤, ì‹¤í–‰ ì¤‘ì¸ ë‹¤ë¥¸ DML/DDLì„ ë§‰ì„ ìˆ˜ ìˆìŒ

---

### Named Lock
- **íŠ¹ì • ë¬¸ìì—´**(Key)ì— ëŒ€í•´ ì ê¸ˆ ì„¤ì • ê°€ëŠ¥
- `GET_LOCK`(str, timeout) í•¨ìˆ˜ë¡œ íšë“, `RELEASE_LOCK`(str) í•¨ìˆ˜ë¡œ í•´ì œ
- ì„œë²„ ë‹¨ìœ„(Session ë‹¨ìœ„) ì ê¸ˆì´ë¯€ë¡œ, ê°™ì€ MySQL ì¸ìŠ¤í„´ìŠ¤ ë‚´ì—ì„œë§Œ ìœ íš¨
- ì‚¬ìš© ì´ìœ 
  - í•˜ë‚˜ì˜ ìì›ì„ ì—¬ëŸ¬ ì„¸ì…˜ì´ ë™ì‹œì— ì ‘ê·¼í•˜ì§€ ì•Šë„ë¡ **ë™ê¸°í™” ì œì–´**
  - ë³µì¡í•œ ë ˆì½”ë“œ ë³€ê²½ ì‘ì—…, ë°°ì¹˜ í”„ë¡œê·¸ë¨, ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰ ì‹œ **ì¶©ëŒ ë°©ì§€**
  - ë¶„ì‚° ë½ì²˜ëŸ¼ í™œìš© ê°€ëŠ¥í•˜ì§€ë§Œ, MySQL ì¸ìŠ¤í„´ìŠ¤ ë‹¨ì¼ ë²”ìœ„ì— êµ­í•œë¨
- ì˜ˆì‹œ
  - **ë°°ì¹˜ í”„ë¡œê·¸ë¨**ì´ ëŒ€ëŸ‰ ë ˆì½”ë“œë¥¼ ë³€ê²½í•˜ëŠ” ë™ì•ˆ **ë‹¤ë¥¸ ì„¸ì…˜ì—ì„œ ë™ì¼í•œ ë°ì´í„°ë¥¼ ê±´ë“œë¦¬ì§€ ëª»í•˜ê²Œ ë„¤ì„ë“œ ë½ ì„¤ì •**
  - íŠ¹ì • í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‹œì— ë‘ ë²ˆ ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ ë°©ì§€ (GET_LOCK('batch_job', 10))
- ì£¼ì˜ì‚¬í•­
  - Named Lockì€ íŠ¸ëœì­ì…˜ ë¡¤ë°±ê³¼ ë¬´ê´€ -> íŠ¸ëœì­ì…˜ì´ ë¡¤ë°±ë¼ë„ ë½ì€ ìë™ í•´ì œë˜ì§€ ì•ŠìŒ
  - ì„¸ì…˜ì´ ëŠê¸°ë©´ ìë™ í•´ì œë¨
  - ì˜ëª» ì‚¬ìš©í•˜ë©´ ë³‘ëª© êµ¬ê°„ì´ ìƒê¸¸ ìˆ˜ ìˆì–´ **ë½ ë²”ìœ„ë¥¼ ìµœì†Œí™”**í•´ì•¼ í•¨

---

### MetaData Lock 
- **DB ê°ì²´**(í…Œì´ë¸”, ë·° ë“±)ì˜ **ì´ë¦„ì´ë‚˜ êµ¬ì¡°ë¥¼ ë³€ê²½**í•˜ê±°ë‚˜ **ì ‘ê·¼**í•  ë•Œ ìë™ìœ¼ë¡œ íšë“í•˜ëŠ” lock
- ì˜ˆì‹œ: `RENAME TABLE tab_a TO tab_b` ì‹¤í–‰ ì‹œ ìë™ íšë“
  - ì›ë³¸ ì´ë¦„ê³¼ ë³€ê²½ëœ ì´ë¦„ ëª¨ë‘ì— ëŒ€í•´ ë™ì‹œì— ë½ ì„¤ì •
  - DML/DDLì´ ë™ì‹œì— ì‹¤í–‰ë  ë•Œ ì¶©ëŒì„ ë°©ì§€
- íŠ¹ì§•
  - ëª¨ë“  DDL, DMLì€ ê´€ë ¨ ê°ì²´ì— ëŒ€í•´ MDLì„ ìë™ íšë“
  - DML(SELECT, INSERT, UPDATE ë“±): ê³µìœ  ì ê¸ˆ(Shared Lock) -> ì½ê¸°/ì“°ê¸° ê°€ëŠ¥
  - DDL(ALTER TABLE, RENAME ë“±): ë°°íƒ€ ì ê¸ˆ(Exclusive Lock) -> ë‹¤ë¥¸ ì„¸ì…˜ì˜ ì ‘ê·¼ ì°¨ë‹¨
  - **MDLì€ íŠ¸ëœì­ì…˜ì´ ëë‚  ë•Œê¹Œì§€ ìœ ì§€ë¨** -> ê¸´ íŠ¸ëœì­ì…˜ì´ ìˆìœ¼ë©´ ë‹¤ë¥¸ ì„¸ì…˜ì˜ DDLì´ ë¬´ê¸°í•œ ëŒ€ê¸°í•  ìˆ˜ ìˆìŒ
  - ëª…ì‹œì ìœ¼ë¡œ ì œì–´í•  ìˆ˜ ìˆëŠ” ê²Œ ì•„ë‹ˆë¼, MySQLì´ ë‚´ë¶€ì ìœ¼ë¡œ ê±¸ì–´ì£¼ëŠ” ì‹œìŠ¤í…œ ë½
- ì˜ˆì‹œ
  - **ë°°ì¹˜ í”„ë¡œê·¸ë¨**ì—ì„œ í…Œì´ë¸”ì„ ë™ì‹œì— ì—¬ëŸ¬ ê°œ rename í•˜ë ¤ëŠ” ê²½ìš°
    - `RENAME TABLE A TO B, C TO A` ì²˜ëŸ¼ í•œ ë²ˆì— ì‹¤í–‰í•´ì•¼ ì•ˆì „
    - ë‚˜ëˆ ì„œ ì‹¤í–‰í•˜ë©´, **MDL ì¶©ëŒ**ë¡œ ì¸í•´ Table not found ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥
  - í…Œì´ë¸” êµ¬ì¡° ë³€ê²½(DDL)ì€ ë‹¨ì¼ ìŠ¤ë ˆë“œ ì‘ì—…ì´ë¼ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŒ
    - í•´ê²° ë°©ë²•
      - ìƒˆë¡œìš´ í…Œì´ë¸”ì„ ë§Œë“¤ê³  **ë°ì´í„°ë¥¼ ë³‘ë ¬ ë³µì‚¬**(ì‹œê°„ ë‹¨ì¶•)
      - **ìµœê·¼ ë°ì´í„°ë§Œ ì ê¹ì˜ ë½**ì„ ê±¸ê³  ë³µì‚¬ -> ë‹¤ìš´íƒ€ì„ ìµœì†Œí™”
      - ë§ˆì§€ë§‰ìœ¼ë¡œ **RENAME TABLEë¡œ í…Œì´ë¸” êµì²´**
- ì£¼ì˜ì‚¬í•­
  - ê¸´ ì¿¼ë¦¬(íŠ¹íˆ ì˜¤ë˜ ê±¸ë¦¬ëŠ” SELECT)ê°€ ì‹¤í–‰ ì¤‘ì¸ ìƒíƒœì—ì„œ DDL ì‹¤í–‰í•˜ë©´, DDLì´ MDL íšë“ ëŒ€ê¸° ìƒíƒœë¡œ ë©ˆì¶°ë²„ë¦¼
  - ì´ëŸ° ìƒí™©ì€ MySQL ì„œë²„ ìš´ì˜ì—ì„œ ìì£¼ ì¥ì•  ì›ì¸ì´ ë˜ë¯€ë¡œ, ìš´ì˜ ì¤‘ì—ëŠ” DDL ì‹¤í–‰ ì‹œê° ì¡°ì •ì´ ì¤‘ìš”

---

### InnoDB ìŠ¤í† ë¦¬ì§€ ì—”ì§„ lock
- Record Lock
  - **ì¸ë±ìŠ¤**ì˜ ë ˆì½”ë“œ(=Row)ë¥¼ ì ê¸ˆ
  - íŠ¹ì • ë ˆì½”ë“œ ë‹¨ìœ„ë¡œ **ë™ì‹œì„± ì œì–´**
  - ì¸ë±ìŠ¤ê°€ ì—†ëŠ” ê²½ìš°ì—ë„ InnoDBëŠ” ë‚´ë¶€ì ìœ¼ë¡œ **ìˆ¨ì€ í´ëŸ¬ìŠ¤í„° ì¸ë±ìŠ¤(ìë™ ìƒì„± PK)**ë¥¼ ì´ìš©í•´ ì ê¸ˆ ì„¤ì •
  - ë”°ë¼ì„œ WHERE ì¡°ê±´ìœ¼ë¡œ ê²€ìƒ‰ëœ ë ˆì½”ë“œê°€ ì ê¹€
- Gap Lock
  - ë ˆì½”ë“œì™€ ë ˆì½”ë“œ ì‚¬ì´ì˜ ê°„ê²©ì„ ì ê¸ˆ
  - ì¡°ê±´ì— ë§ëŠ” ë ˆì½”ë“œ ìì²´ë¿ ì•„ë‹ˆë¼, ê·¸ ì‚¬ì´ì— **ìƒˆë¡œìš´ ë ˆì½”ë“œê°€ ì‚½ì…ë˜ëŠ” ê²ƒê¹Œì§€ ì œì–´**
  - ì£¼ë¡œ REPEATABLE READ ê²©ë¦¬ ìˆ˜ì¤€ì—ì„œ ë°œìƒ
  - íŒ¬í…€ ë¦¬ë“œ(Phantom Read)ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ ì ê¸ˆ
- Next Key Lock
  - Record Lock + Gap Lockì„ í•©ì¹œ í˜•íƒœ
  - íŠ¹ì • ë ˆì½”ë“œì™€ ê·¸ ì „í›„ ê°„ê²©ê¹Œì§€ ë™ì‹œì— ì ê¸ˆ
  - MySQL ê¸°ë³¸ ê²©ë¦¬ ìˆ˜ì¤€(`REPEATABLE READ`)ì—ì„œ UPDATE/DELETE ì‹œ ìë™ ì ìš©
  - `innodb_locks_unsafe_for_binlog`ì˜µì…˜ì´ ë¹„í™œì„±í™”ëœ ê²½ìš° ê°•ì œ ì‚¬ìš©
  - ëª©ì : ë°”ì´ë„ˆë¦¬ ë¡œê·¸ë¥¼ ì´ìš©í•œ ë³µì œ ì‹œ, **ì†ŒìŠ¤ ì„œë²„ì™€ ë ˆí”Œë¦¬ì¹´ ì„œë²„ì˜ ì‹¤í–‰ ê²°ê³¼ë¥¼ ì¼ê´€ë˜ê²Œ ìœ ì§€**í•˜ê¸° ìœ„í•¨
- ìë™ ì¦ê°€ ë½ (Auto-Inc Lock)
  - `AUTO_INCREMENT` ì»¬ëŸ¼ì´ ìˆëŠ” í…Œì´ë¸”ì— ì—¬ëŸ¬ íŠ¸ëœì­ì…˜ì´ ë™ì‹œì— INSERT í•  ë•Œ, **ìë™ ì¦ê°€ ê°’ì˜ ì¤‘ë³µì„ ë°©ì§€**í•˜ê¸° ìœ„í•´ í…Œì´ë¸” ë‹¨ìœ„ ë½ì„ ì‚¬ìš©
  - ê¸°ë³¸ì ìœ¼ë¡œ ì§§ì€ ì‹œê°„ ë™ì•ˆë§Œ í…Œì´ë¸” ìˆ˜ì¤€ ì ê¸ˆì„ ì¡ìŒ (insert ë˜ëŠ” ë™ì•ˆë§Œ)
  - MySQL 8.0ì—ì„œëŠ” `innodb_autoinc_lock_mode` ì„¤ì •ìœ¼ë¡œ ë™ì‘ ë°©ì‹ ì œì–´ ê°€ëŠ¥
    - 0 (traditional): ëª¨ë“  INSERTì— í…Œì´ë¸” ë½ (ì•ˆì „í•˜ì§€ë§Œ ë™ì‹œì„± ë‚®ìŒ)
    - 1 (consecutive, ê¸°ë³¸ê°’): ë‹¨ìˆœ INSERTëŠ” ë¹ ë¥¸ ë½, ë³µì¡ INSERT(SELECT ê¸°ë°˜)ëŠ” í…Œì´ë¸” ë½
    - 2 (interleaved): ê°€ì¥ ë™ì‹œì„± ë†’ì§€ë§Œ, binlogê°€ STATEMENT ëª¨ë“œë©´ ìœ„í—˜

---

## Isolation Level
- ì—¬ëŸ¬ íŠ¸ëœì­ì…˜ì´ ë™ì‹œì— ì²˜ë¦¬ë  ë•Œ, í•œ íŠ¸ëœì­ì…˜ì´ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì˜ ë³€ê²½ ë˜ëŠ” ì¡°íšŒ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆì„ì§€ ê²°ì •í•˜ëŠ” ìˆ˜ì¤€
- `READ UNCOMMITED`
  - íŠ¸ëœì­ì…˜ì˜ commit, rollback ì—¬ë¶€ ìƒê´€ì—†ì´ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì˜ ë³€ê²½ ë‚´ìš©ë„ ì½ì„ ìˆ˜ ìˆìŒ -> **Dirty Read ë°œìƒ** ê°€ëŠ¥
  - InnoDBëŠ” MVCC ê¸°ë°˜ì´ê¸´ í•˜ì§€ë§Œ, ì´ ë ˆë²¨ì—ì„œëŠ” undo ë¡œê·¸ë¥¼ ë¬´ì‹œí•˜ê³  ìµœì‹  ë°ì´í„°ë¥¼ ë°”ë¡œ ì¡°íšŒí•¨
  - Dirty Read: íŠ¸ëœì­ì…˜ì—ì„œ ì²˜ë¦¬í•œ ì‘ì—…ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ì„ ë•Œ, ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ë³¼ ìˆ˜ ìˆëŠ” í˜„ìƒ
  - ë°ì´í„° ì •í•©ì„±ì— ë¬¸ì œê°€ ë§ì´ ë°œìƒ
- `READ COMMITED`
  - **commitì´ ì™„ë£Œëœ ë°ì´í„°ë§Œ** ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ì¡°íšŒ ê°€ëŠ¥ -> Dirty Read ì—†ìŒ
  - **íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ê°™ì€ ì¿¼ë¦¬ë¼ë„ ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•˜ë©´ ë‹¤ë¥¸ ê²°ê³¼**ê°€ ë‚˜ì˜¬ ìˆ˜ ìˆìŒ (Non-repeatable Read ë°œìƒ ê°€ëŠ¥)
  - ê° SELECT ì‹œì ë§ˆë‹¤ ìƒˆë¡œìš´ Read View ìƒì„±
  - ì´ëŸ¬í•œ ë¬¸ì œëŠ” í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì— ë™ì¼ ë°ì´í„°ì— ì—¬ëŸ¬ ë²ˆ ì ‘ê·¼í•˜ëŠ” ê¸ˆìœµ ì‹œìŠ¤í…œì—ì„œ ìœ„í—˜í•  ìˆ˜ ìˆìŒ
  - Oracle ê¸°ë³¸
- `REPEATABLE READ`
  - MVCCë¥¼ ìœ„í•´ **undo ì˜ì—­ ë°±ì—… ë°ì´í„°**ë¥¼ ì´ìš©í•´ **íŠ¸ëœì­ì…˜ ë‚´ì—ëŠ” ê°™ì€ ê²°ê³¼ë¥¼ ë°˜í™˜**í•  ìˆ˜ ìˆë„ë¡ ë³´ì¥
  - MVCC(Multi Version Concurrency Control): íŠ¸ëœì­ì…˜ì´ rollback ë  ê°€ëŠ¥ì„±ì„ ëŒ€ë¹„í•´ ë³€ê²½ ì „ ë ˆì½”ë“œë¥¼ undo ê³µê°„ì— ë°±ì—…í•´ë‘ê³  ì‹¤ì œ ë ˆì½”ë“œ ê°’ì„ ë³€ê²½í•˜ëŠ” ê²ƒ
  - ëª¨ë“  InnoDBì˜ íŠ¸ëœì­ì…˜ì€ ê³ ìœ í•œ ìˆœì°¨ì ìœ¼ë¡œ ì¦ê°€í•˜ëŠ” íŠ¸ëœì­ì…˜ ë²ˆí˜¸ë¥¼ ê°€ì§€ê³  ìˆê³ , undo ë°±ì—… ë ˆì½”ë“œì—ëŠ” ë³€ê²½ì„ ë°œìƒì‹œí‚¨ íŠ¸ëœì­ì…˜ ë²ˆí˜¸ë¥¼ í¬í•¨í•¨
  - `READ COMMITTED`ëŠ” ë§¤ SELECTë§ˆë‹¤ ìµœì‹  ì»¤ë°‹ëœ ë²„ì „ì„ ë°˜í™˜í•˜ê³ , `REPEATABLE READ`ëŠ” **íŠ¸ëœì­ì…˜ ì‹œì‘ ì‹œì ì˜ ìŠ¤ëƒ…ìƒ· ë²„ì „ì„ ëê¹Œì§€ ìœ ì§€**
  - íŒ¬í…€ ë¦¬ë“œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ Next-Key Lock (Record Lock + Gap Lock) ì‚¬ìš©
  - MySQL/InnoDB ê¸°ë³¸
- `SERIALIZABLE`
  - í•œ íŠ¸ëœì­ì…˜ì—ì„œ ì½ê³  ì“°ëŠ” ë ˆì½”ë“œëŠ” ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ë¬´ì¡°ê±´ ì ‘ê·¼ ë¶ˆê°€
  - SELECTë„ ê¸°ë³¸ì ìœ¼ë¡œ ê³µìœ  ë½ì„ ê±¸ì–´ ì‹¤í–‰ë˜ë©° ë™ì‹œì„±ì´ ë§¤ìš° ë‚®ìŒ
  - MySQLì—ì„œëŠ” `REPEATABLE READ` ì—ì„œë„ Next-Key Lock ì„ í™œìš©í•´ íŒ¬í…€ ë¦¬ë“œë¥¼ ë°©ì§€í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì‚¬ìš© ì•ˆí•¨

| ê²©ë¦¬ ìˆ˜ì¤€            | Dirty Read | Non-repeatable Read | Phantom Read | MVCC ì¼ê´€ì„± | Lock ë°©ì‹          | ì„¤ëª…            |
| ---------------- | ---------- | ------------------- | ------------ | -------- | ---------------- | ------------- |
| READ UNCOMMITTED | ê°€ëŠ¥         | ê°€ëŠ¥                  | ê°€ëŠ¥           | ì‘ë™ ì•ˆ í•¨   | ìµœì‹  ë²„ì „ë§Œ ì½ìŒ        | ê°€ì¥ ë‚®ì€ ê²©ë¦¬ ìˆ˜ì¤€   |
| READ COMMITTED   | ë¶ˆê°€         | ê°€ëŠ¥                  | ê°€ëŠ¥           | ì‘ë™       | ë§¤ SELECTë§ˆë‹¤ ìŠ¤ëƒ…ìƒ·   | ì»¤ë°‹ëœ ë°ì´í„°ë§Œ ì½ê¸°   |
| REPEATABLE READ  | ë¶ˆê°€         | ë¶ˆê°€                  | ë¶ˆê°€ëŠ¥          | ìµœê³        | Next-Key Lock ì‚¬ìš© | ê¸°ë³¸, ì¼ê´€ëœ ì½ê¸° ë³´ì¥ |
| SERIALIZABLE     | ë¶ˆê°€         | ë¶ˆê°€                  | ë¶ˆê°€ëŠ¥          | ì‘ë™       | Shared ë½ ê°•í™”      | ê°€ì¥ ì•ˆì „í•˜ì§€ë§Œ ëŠë¦¼   |


--- 

### InnoDB ìŠ¤í† ë¦¬ì§€ ì—”ì§„
- MySQL 8.0 ê¸°ì¤€ìœ¼ë¡œ ê¸°ë³¸ ìŠ¤í† ë¦¬ì§€ ì—”ì§„
- ì£¼ìš” íŠ¹ì§•
  - ACID íŠ¸ëœì­ì…˜ ì§€ì›
    - COMMIT, ROLLBACK, Crash Recoveryë¥¼ í†µí•´ ë°ì´í„°ì˜ ì¼ê´€ì„± ë° ì‹ ë¢°ì„± ë³´ì¥
  - í–‰ ë ˆë²¨ ì ê¸ˆ(Row-Level Locking) ë° MVCC (ë‹¤ì¤‘ ë²„ì „ ë™ì‹œì„± ì œì–´)
    - ë†’ì€ ë™ì‹œì„± ì²˜ë¦¬ ì„±ëŠ¥ ì œê³µ
  - í´ëŸ¬ìŠ¤í„°í˜• ì¸ë±ìŠ¤(Clustered Index)
    - ê¸°ë³¸ í‚¤ ê¸°ë°˜ ë°ì´í„° ë¬¼ë¦¬ ì €ì¥ìœ¼ë¡œ íš¨ìœ¨ì ì¸ ì¡°íšŒ ë° I/O ìµœì í™”
  - ì™¸ë˜ í‚¤ ì œì•½(Foreign Key Support)
    - í…Œì´ë¸” ê°„ ì°¸ì¡° ë¬´ê²°ì„± ìœ ì§€
  - ë²„í¼ í’€(Buffer Pool)
    - ìì£¼ ì ‘ê·¼ë˜ëŠ” ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ìºì‹±í•˜ì—¬ ì†ë„ í–¥ìƒ
  - ì˜¨ë¼ì¸ êµ¬ì¡° ë³€ê²½(Online DDL), Full-Text ë° ê³µê°„(Spatial) ì¸ë±ìŠ¤ ì§€ì›, ì•”í˜¸í™”, ì••ì¶• ë“±
- InnoDB ì˜ ìˆœìˆ˜ select, createëŠ” ì•„ë¬´ëŸ° lock ì´ ì—†ìŒ(Non-locking consistent lock)

| í•­ëª©             | InnoDB        | MyISAM (ì´ì „ ê¸°ë³¸ ì—”ì§„) |
| -------------- | ------------- | ----------------- |
| íŠ¸ëœì­ì…˜ ì§€ì›        | ìˆìŒ (ACID)     | ì—†ìŒ                |
| ì ê¸ˆ ë°©ì‹          | í–‰ ë ˆë²¨ (ë™ì‹œì„± ë†’ìŒ) | í…Œì´ë¸” ë ˆë²¨ (ë™ì‹œì„± ë‚®ìŒ)   |
| ì™¸ë˜ í‚¤           | ìˆìŒ            | ì—†ìŒ                |
| Crash Recovery | robust        | ì·¨ì•½                |
| ê¸°ë³¸ ì—”ì§„          | MySQL 5.5 ì´í›„  | MySQL 5.5 ì´ì „      |

---

### Propagation (íŠ¸ëœì­ì…˜ ì „íŒŒ)
- íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ë‹¤ë¥¸ `@Transactional` ë©”ì„œë“œë¥¼ í˜¸ì¶œí–ˆì„ ë•Œ, ê¸°ì¡´ íŠ¸ëœì­ì…˜ì— ì°¸ì—¬í• ì§€, ìƒˆë¡œ ë§Œë“¤ì§€, ëŠì„ì§€ë¥¼ ê²°ì •í•˜ëŠ” ì •ì±…
- **REQUIRED (ê¸°ë³¸ê°’)**: ê¸°ì¡´ ìˆìœ¼ë©´ ì°¸ì—¬, ì—†ìœ¼ë©´ ìƒˆë¡œ ì‹œì‘ (ê°€ì¥ ë§ì´ ì”€)
- **REQUIRES NEW**: ë¬´ì¡°ê±´ ìƒˆë¡œ ì‹œì‘, ê¸°ì¡´ íŠ¸ëœì­ì…˜ì€ ì ì‹œ ì¤‘ë‹¨ (ë¡œê·¸/ì´ë ¥ ì €ì¥ì— í™œìš©)
- **SUPPORTS**: ìˆìœ¼ë©´ ì°¸ì—¬, ì—†ìœ¼ë©´ íŠ¸ëœì­ì…˜ ì—†ì´ ì‹¤í–‰
- **MANDATORY**: ê¸°ì¡´ íŠ¸ëœì­ì…˜ì´ ë°˜ë“œì‹œ ìˆì–´ì•¼ í•¨, ì—†ìœ¼ë©´ ì˜ˆì™¸
- **NOT SUPPORTED**: íŠ¸ëœì­ì…˜ ì¤‘ë‹¨í•˜ê³  ë¹„íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì‹¤í–‰
- **NEVER**: íŠ¸ëœì­ì…˜ì´ ìˆìœ¼ë©´ ì˜ˆì™¸ ë°œìƒ
- **NESTED**: ë™ì¼ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ **ì„¸ì´ë¸Œí¬ì¸íŠ¸**ë¥¼ ë§Œë“¤ì–´ ë¶€ë¶„ ë¡¤ë°± ê°€ëŠ¥ (JDBC ì§€ì› í•„ìš”)

---

### Spring `@Transactional`
- ë©”ì„œë“œë‚˜ í´ë˜ìŠ¤ ë‹¨ìœ„ë¡œ íŠ¸ëœì­ì…˜ ê²½ê³„(ì‹œì‘ -> ì»¤ë°‹/ë¡¤ë°±)ë¥¼ ìë™ìœ¼ë¡œ ê´€ë¦¬í•´ì£¼ëŠ” ìŠ¤í”„ë§ì˜ ì–´ë…¸í…Œì´ì…˜
- ê°œë°œìê°€ `try-catch`ë¡œ ì§ì ‘ `commit/rollback` í•˜ì§€ ì•Šì•„ë„ ë¨ -> **ì„ ì–¸í˜• íŠ¸ëœì­ì…˜ ê´€ë¦¬**
- ì‹¤ì œë¡  **ìŠ¤í”„ë§ AOP í”„ë¡ì‹œ**ê°€ ë©”ì„œë“œ í˜¸ì¶œì„ ê°€ë¡œì±„ì„œ íŠ¸ëœì­ì…˜ì„ ì‹œì‘/ì¢…ë£Œ/ë¡¤ë°±í•¨
- ì—¬ê¸°ì„œ ì ê¹!!
- AOPë€? (Aspect Oriented Programming)
  - ê´€ì  ì§€í–¥ í”„ë¡œê·¸ë˜ë°: í•µì‹¬ ë¡œì§(ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)ê³¼ **ë¶€ê°€ ê¸°ëŠ¥(ê³µí†µ ê´€ì‹¬ì‚¬)**ì„ ë¶„ë¦¬í•´ì„œ ê´€ë¦¬í•˜ëŠ” ë°©ì‹
  - ex. í•µì‹¬: ì£¼ë¬¸ ê²°ì œ, íšŒì› ê°€ì…, ê²Œì‹œê¸€ ì‘ì„± / ë¶€ê°€: ë¡œê¹…, ë³´ì•ˆ, íŠ¸ëœì­ì…˜, ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
  - ë¶€ê°€ ê¸°ëŠ¥ì„ ì§ì ‘ ì½”ë“œì— ì“°ì§€ ì•Šê³ , **í•œ ê³³ì— ëª¨ì•„ ê´€ë¦¬í•˜ê³  ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ ë¼ì›Œ ë„£ìŒ**!!
  - ì¥ì 
    - **ì¤‘ë³µ ì½”ë“œ ì œê±°**: ëª¨ë“  ì„œë¹„ìŠ¤ ë©”ì„œë“œë§ˆë‹¤ try-catchë¡œ íŠ¸ëœì­ì…˜ ì‹œì‘/ì¢…ë£Œ â†’ ë„ˆë¬´ ë°˜ë³µ+ë³µì¡
    - **ìœ ì§€ë³´ìˆ˜ ìš©ì´**: ê³µí†µ ê¸°ëŠ¥ì„ ë”°ë¡œ ê´€ë¦¬í•˜ë©´ ìˆ˜ì •ì´ ì‰¬ì›€
    - **ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬**(SoC): í•µì‹¬ ë¡œì§ì€ ë¹„ì¦ˆë‹ˆìŠ¤ì—ë§Œ ì§‘ì¤‘, ë¶€ê°€ ê¸°ëŠ¥ì€ AOPì—ì„œ ê´€ë¦¬

---

### Self-invocation ë¬¸ì œ
- `@Transactional`ì€ ê¸°ë³¸ì ìœ¼ë¡œ **í”„ë¡ì‹œ ë°©ì‹**ìœ¼ë¡œ ë™ì‘
- ì¦‰, **ì™¸ë¶€ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ë©”ì„œë“œ í˜¸ì¶œ**ë§Œ ê°€ë¡œì±„ì„œ íŠ¸ëœì­ì…˜ì„ ì ìš©
- **ê°™ì€ í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ `this.method()`ë¡œ í˜¸ì¶œ**í•˜ë©´ í”„ë¡ì‹œë¥¼ ì•ˆ ê±°ì¹˜ë¯€ë¡œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠìŒ -> **self-invocation ë¬¸ì œ**
- í•´ê²° ë°©ë²•
  - ìê¸° ìì‹ ì„ í”„ë¡ì‹œ í˜•íƒœë¡œ ì£¼ì…ë°›ì•„ í˜¸ì¶œ (`this` ëŒ€ì‹  ì£¼ì…ë°›ì€ ìê¸° ìì‹  `self` ì‚¬ìš©)
  - íŠ¸ëœì­ì…˜ì„ ë¶„ë¦¬í•  ë©”ì„œë“œë¥¼ ë‹¤ë¥¸ í´ë˜ìŠ¤(Service)ë¡œ ì´ë™
  - AspectJ ëª¨ë“œ ì‚¬ìš©

---

### RollBack ê·œì¹™
- ê¸°ë³¸ì ìœ¼ë¡œ **`RuntimeException`ì´ë‚˜ `Error` ë°œìƒ ì‹œ ë¡¤ë°±**
- ì²´í¬ ì˜ˆì™¸(ì˜ˆ: `IOException`)ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë¡¤ë°± ì•ˆ í•¨
- í•„ìš”í•˜ë©´ `rollbackFor` / `noRollbackFor` ì˜µì…˜ìœ¼ë¡œ ì œì–´ ê°€ëŠ¥

```java
@Transactional(rollbackFor = IOException.class)
public void test(...) { ... }
```

---

### `readOnly = true`
- **ì“°ê¸° ì‘ì—…ì´ ì—†ëŠ” ì¡°íšŒ ì „ìš© íŠ¸ëœì­ì…˜**ì—ì„œ ì‚¬ìš©
- ì¥ì 
  - JPA/HibernateëŠ” ë¶ˆí•„ìš”í•œ ì‘ì—…(ë³€ê²½ ê°ì§€, flush ë“±)ì„ ì¤„ì—¬ **ì¡°íšŒ ì„±ëŠ¥ì„ ìµœì í™”**
  - ë°ì´í„°ë² ì´ìŠ¤ ë“œë¼ì´ë²„ì— ì½ê¸° ì „ìš© íŒíŠ¸ë¥¼ ì „ë‹¬í•˜ê¸°ë„ í•¨
- ì£¼ì˜: ë¬´ì¡°ê±´ ì“°ê¸° ê¸ˆì§€ë¥¼ ê°•ì œí•˜ëŠ” ê±´ ì•„ë‹ˆê³ , ê°œë°œì ê·œìœ¨ ì°¨ì›ì—ì„œ ì˜ë¯¸ê°€ í¼ (DB ë§ˆë‹¤ ë‹¤ë¦„)

---

### ì½”ë“œë¡œ ì•Œì•„ë³´ëŠ” `@Transactional`!! ì™€ ì‹ ë‚œë‹¤~~

### íŠ¸ëœì­ì…˜ì„ ì´ìš©í•œ Lazy Loading ë¬¸ì œ í•´ê²° (`readOnly = true`)
  ```java
  @Override
  @Transactional(readOnly = true)
  public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
      UserEntity user = userRepository.findById(Long.valueOf(username))
                                      .orElseThrow(() -> new UsernameNotFoundException("User Not Found"));

      // íŠ¸ëœì­ì…˜ ì‹œì‘ -> íŠ¸ëœì­ì…˜ ë‚´ë¶€ì—ì„œ role ì ‘ê·¼ -> ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì‚´ì•„ìˆìŒ -> LazyInitializationException ë°©ì§€
      user.setAuthorities(user.getRoles().stream()
          .map(role -> new SimpleGrantedAuthority(role.getRole()))
          .collect(Collectors.toList()));

      return user;
  }
  ```

---

### ë¡¤ë°± í™•ì¸ (ëŸ°íƒ€ì„ ì˜ˆì™¸ ì‹œ ë¡¤ë°±)

```java
@Service
public class OrderService {
    @Transactional
    public void placeOrder(Long userId, Long productId) {
        // Order ì €ì¥í•˜ëŠ” ë¡œì§
        orderRepository.save(new Order(userId, productId)); // ì•„ì§ ì»¤ë°‹ ì•„ë‹˜(ì“°ê¸° ì§€ì—°)

        if (productId == 999L) { // ê°•ì œ ì˜ˆì™¸(ëŸ°íƒ€ì„ ì˜ˆì™¸)
            // íŠ¸ëœì­ì…˜ ì¸í„°ì…‰í„°ê°€ ì˜ˆì™¸ë¥¼ ê°ì§€í•´ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±!!
            throw new IllegalStateException("ì¬ê³  ë¶€ì¡±!");
        }

        // Payment ì €ì¥í•˜ëŠ” ë¡œì§
        paymentRepository.save(new Payment(userId, productId));
        // ë©”ì„œë“œ ì •ìƒ ì¢…ë£Œ -> ì»¤ë°‹ ì‹œë„
    }
}
```
- ì˜ˆì™¸ ë°œìƒ ì‹œ `Order`/`Payment` ëª¨ë‘ ë¡¤ë°±ë¨


---

### REQUIRED (ê¸°ë³¸ ì „íŒŒ ì†ì„±)
- ì´ë¯¸ íŠ¸ëœì­ì…˜ì´ ìˆìœ¼ë©´ í•©ë¥˜(join)í•˜ê³ , ì—†ìœ¼ë©´ ìƒˆë¡œ ì‹œì‘
```java
@Service
public class OrderService {
    @Transactional // ê¸°ë³¸ propagation = REQUIRED
    public void placeOrder(Long userId, Long productId) {
        orderRepository.save(new Order(userId, productId));
        // ì–´ë! ê¸°ì¡´ì— ì‹¤í–‰ì¤‘ì¸ íŠ¸ëœì­ì…˜ì´ ìˆêµ¬ë‚˜!
        // ì´ë¯¸ ì§„í–‰ ì¤‘ì¸ ê°™ì€ íŠ¸ëœì­ì…˜ì— í•©ë¥˜
        // ì¦‰! ë‘ ë©”ì„œë“œ(placeOrder + savePayment)ëŠ” í•œ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì—¬ ì‹¤í–‰
        paymentService.savePayment(userId, productId); // REQUIRED
    }
}

@Service
public class PaymentService {
    @Transactional // propagation = REQUIRED (ê¸°ë³¸)
    public void savePayment(Long userId, Long productId) {
        paymentRepository.save(new Payment(userId, productId));
    }
}

```
- ì˜ˆì™¸ ë°œìƒ ì‹œ ì „ì²´ rollback (Order, Payment ë‘˜ ë‹¤ ì·¨ì†Œ)

---

### `REQUIRES_NEW` (ì´ë ¥ ì €ì¥ ë¶„ë¦¬ ì»¤ë°‹)
- í˜„ì¬ íŠ¸ëœì­ì…˜(ìˆë‹¤ë©´) ì¼ì‹œ ì¤‘ë‹¨ -> ìƒˆ ë¬¼ë¦¬ íŠ¸ëœì­ì…˜ì„ ì‹œì‘ (ë³´í†µ ë‹¤ë¥¸ DB ì»¤ë„¥ì…˜ ì‚¬ìš©) -> `saveLog()` ì‹¤í–‰ í›„ ì¦‰ì‹œ ì»¤ë°‹/ë¡¤ë°± -> ê¸°ì¡´ íŠ¸ëœì­ì…˜ ì¬ê°œ

```java
@Service
public class LogService {
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void saveLog(String message) {
        systemLogRepository.save(new SystemLog(message));
    }
}
```

```java
@Service
public class TestService {
  private final TestService testService;
  private final LogService logService;

  @Transactional // ê¸°ë³¸ REQUIRED
  public void test(...) {
    testService.test(...);           // ê¸°ì¡´ íŠ¸ëœì­ì…˜
    logService.saveLog("ì£¼ë¬¸ ì‹œë„");       // REQUIRES_NEW(ë¶„ë¦¬ ì»¤ë°‹)
    // ì—¬ê¸°ì„œ ì˜ˆì™¸ê°€ ë‚˜ë©´ ë°”ê¹¥ íŠ¸ëœì­ì…˜ì€ ë¡¤ë°±ë˜ì§€ë§Œ,
    // saveLog()ëŠ” ì´ë¯¸ ë³„ë„ë¡œ ì»¤ë°‹ ì™„ë£Œ!!
  }
}
```
- íŠ¸ëœì­ì…˜ì´ ì‹¤íŒ¨í•´ë„ ë¡œê·¸ëŠ” **ë³„ë„ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì»¤ë°‹**

---

### Self-invocation ë¬¸ì œ ì˜ˆì‹œ & í•´ê²°

```java
@Service
public class MemberService {

    private final MemberService self; // ìê¸° ìì‹  í”„ë¡ì‹œ ì£¼ì…

    public MemberService(MemberService self) {
        this.self = self;
    }

    @Transactional
    public void registerMember() {
        self.validateMember(); // í”„ë¡ì‹œë¥¼ ê±°ì³ í˜¸ì¶œ -> íŠ¸ëœì­ì…˜ ì ìš©ë¨
    }

    @Transactional
    public void validateMember() {
        ... 
    }
}
```

---

## 3. ì°¸ê³ /ì¶”ê°€ ìë£Œ (References)
- [MySQL Transaction Isolation Levels](https://dev.mysql.com/doc/refman/8.4/en/innodb-transaction-isolation-levels.html)
- [MySQL InnoDB Introduction](https://dev.mysql.com/doc/refman/8.4/en/innodb-introduction.html)
- RealMySQL 8.0
- [Spring Framework Docs â€“ Transaction Management](https://docs.spring.io/spring-framework/reference/data-access/transaction.html)
- [Baeldung â€“ Spring @Transactional](https://www.baeldung.com/transaction-configuration-with-jpa-and-spring)

---

## 4. ë‚´ì¼/ë‹¤ìŒì— ë³¼ ê²ƒ (Next Steps)
- ì§„ì‹¬ ë„ˆë¬´ë„ˆë¬´ë„ˆë¬´ ì–´ë ¤ì›Œì„œ ë°˜ë„ ì´í•´ ëª»í•œ ê²ƒ ê°™ìŒ... 
- ë‚˜ì¤‘ì— ë‹¤ì‹œ ë” ê¹Šê²Œ ê³µë¶€í•˜ì... :;(âˆ©Â´ï¹`âˆ©);:
- ë‚œ ì§„ì§œ ë°”ë³´ë‹¤

